<!DOCTYPE html>
<html>
<head>
  <title>After School Lessons</title>

  <!-- Vue 2 -->
  <script src="https://cdn.jsdelivr.net/npm/vue@2"></script>

  <!-- Bootstrap 5 CSS -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">

  <!-- Font Awesome for icons -->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css">

  <style>
    body {
      background: #f4f6f9;
      padding-top: 20px;
    }

    .lesson-card {
      transition: 0.3s;
      border-radius: 12px;
    }

    .lesson-card:hover {
      transform: translateY(-4px);
      box-shadow: 0 4px 12px rgba(0,0,0,0.15);
    }

    .cart-box {
      border-radius: 12px;
      padding: 20px;
    }

    .checkout-btn {
      width: 100%;
      font-size: 1.2rem;
      font-weight: bold;
    }
  </style>
</head>

<body class="p-4">

<div id="app" class="container">

  <!-- HEADER -->
  <div class="d-flex justify-content-between align-items-center mb-4">
    <h1 class="fw-bold">After School Lessons</h1>

    <!-- Cart toggle button: disabled if cart is empty -->
    <button class="btn btn-primary" @click="showLessons = !showLessons" :disabled="cart.length === 0 && !showLessons">
      <i :class="showLessons ? 'fa fa-shopping-cart' : 'fa fa-book'"></i>
      {{ showLessons ? 'View Cart' : 'View Lessons' }}
    </button>
  </div>

  <!-- SEARCH + SORT CONTROLS -->
  <div class="row mb-4" v-if="showLessons">
    <div class="col-md-4 mb-2">
      <!-- Search input bound to searchTerm; filters lessons as you type -->
      <input class="form-control form-control-lg" v-model="searchTerm" placeholder="Search lessons...">
    </div>

    <div class="col-md-3 mb-2">
      <!-- Sort key select -->
      <select class="form-select form-select-lg" v-model="sortKey">
        <option disabled value="">Sort by...</option>
        <option value="subject">Subject</option>
        <option value="location">Location</option>
        <option value="price">Price</option>
        <option value="spaces">Spaces</option>
      </select>
    </div>

    <div class="col-md-3 mb-2">
      <!-- Sort order select -->
      <select class="form-select form-select-lg" v-model="sortOrder">
        <option value="asc">Ascending</option>
        <option value="desc">Descending</option>
      </select>
    </div>
  </div>

  <!-- LESSON GRID -->
<!-- LESSON GRID -->
<div v-if="showLessons" class="row">
  <div class="col-md-4 col-lg-3 mb-4" v-for="lesson in filteredLessons" :key="lesson.id">
    <div class="card lesson-card shadow-sm p-3">

      <!-- Lesson image -->
      <img :src="'images/' + lesson.subject.toLowerCase() + '.jpg'" 
           class="card-img-top mb-3" 
           alt="Lesson Image" 
           style="height:180px; object-fit:cover; border-radius:8px;">

      <!-- Optional Font Awesome icon below image -->
      <div class="text-center mb-3">
        <i :class="lesson.icon" class="fa-2x"></i>
      </div>

      <h4 class="fw-bold">{{ lesson.subject }}</h4>
      <p class="mb-1"><strong>Location:</strong> {{ lesson.location }}</p>
      <p class="mb-1"><strong>Price:</strong> £{{ lesson.price }}</p>
      <p class="mb-2"><strong>Spaces left:</strong> {{ lesson.spaces }}</p>

      <!-- Add to Cart button -->
      <button class="btn btn-success w-100"
              @click="addToCart(lesson)"
              :disabled="lesson.spaces === 0">
        <i class="fa fa-plus-circle"></i> Add to Cart
      </button>

    </div>
  </div>
</div>

  <!-- CART PAGE -->
  <div v-else class="cart-box bg-white shadow-sm">

    <h2 class="fw-bold mb-3">Your Cart</h2>

    <!-- Show message if cart is empty -->
    <div v-if="cart.length === 0" class="alert alert-info">
      Your cart is empty.
    </div>

    <!-- List of lessons in cart -->
    <ul class="list-group mb-3" v-else>
      <li class="list-group-item d-flex justify-content-between align-items-center"
          v-for="(item, index) in cart" :key="index">

        <div>
          <strong>{{ item.subject }}</strong>
          <span class="text-muted"> – £{{ item.price }}</span>
        </div>

        <!-- Remove button restores the space in lesson -->
        <button class="btn btn-sm btn-danger" @click="removeFromCart(index)">
          <i class="fa fa-trash"></i>
        </button>
      </li>
    </ul>

    <!-- Total price -->
    <h4 class="text-end mb-3">
      Total: <strong>£{{ totalPrice }}</strong>
    </h4>

    <!-- Checkout form -->
    <div class="card p-3 mb-3">
      <h5 class="fw-bold">Checkout</h5>

      <!-- Name & Phone input fields -->
      <input class="form-control mb-2" v-model="order.name" placeholder="Your Name">
      <input class="form-control mb-3" v-model="order.phone" placeholder="Phone Number">

      <!-- Checkout button: enabled only if name & phone valid -->
      <button class="btn btn-primary checkout-btn"
              :disabled="!validCheckout"
              @click="submitOrder">
        <i class="fa fa-check"></i> Submit Order
      </button>
    </div>

    <!-- Success message -->
    <div v-if="orderSubmitted" class="alert alert-success">
      Order successfully submitted!
    </div>

  </div>
</div>

<!-- LOAD lessons.js -->
<script src="lessons.js"></script>

<!-- VUE APP -->
<script>
new Vue({
  el: "#app",

  data: {
    lessons: lessons,        // Loaded from lessons.js
    showLessons: true,       // Toggle between lessons and cart
    searchTerm: "",          // User input for search
    sortKey: "",             // Sort by this attribute
    sortOrder: "asc",        // Sort order
    cart: [],                // Array of selected lessons
    orderSubmitted: false,   // Show success message
    order: { name: "", phone: "" } // Checkout inputs
  },

  computed: {

    // Filtered & sorted lessons for display
    filteredLessons() {
      let term = this.searchTerm.toLowerCase();

      // Filter by subject, location, price, spaces
      let list = this.lessons.filter(l =>
        l.subject.toLowerCase().includes(term) ||
        l.location.toLowerCase().includes(term) ||
        l.price.toString().includes(term) ||
        l.spaces.toString().includes(term)
      );

      // Sort if sortKey is selected
      if (this.sortKey) {
        list.sort((a, b) => {
          let A = a[this.sortKey];
          let B = b[this.sortKey];

          // Handle number vs string sorting
          if (typeof A === "number" && typeof B === "number") {
            return this.sortOrder === "asc" ? A - B : B - A;
          } else {
            return this.sortOrder === "asc"
              ? (A.toString().localeCompare(B.toString()))
              : (B.toString().localeCompare(A.toString()));
          }
        });
      }

      return list;
    },

    // Total price of cart
    totalPrice() {
      return this.cart.reduce((sum, l) => sum + l.price, 0);
    },

    // Validation for checkout
    validCheckout() {
      const nameOk = /^[A-Za-z\s]+$/.test(this.order.name.trim());
      const phoneOk = /^[0-9]+$/.test(this.order.phone.trim());
      return nameOk && phoneOk && this.cart.length > 0;
    }
  },

  methods: {

    // Add lesson to cart, decrease spaces
    addToCart(lesson) {
      if (lesson.spaces > 0) {
        lesson.spaces--;
        this.cart.push(lesson);
      }
    },

    // Remove lesson from cart, restore spaces
    removeFromCart(index) {
      this.cart[index].spaces++;
      this.cart.splice(index, 1);
    },

    // Submit order: show success message and reset cart
    submitOrder() {
      if (!this.validCheckout) return;

      this.orderSubmitted = true;
      this.cart = [];
      this.order = { name: "", phone: "" };
    }
  }
});
</script>

</body>
</html>
